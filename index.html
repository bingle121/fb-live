<!DOCTYPE html>
<html>

<head>
    <title>FB Live</title>

    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0;
            text-align: center;
            background: #222;
        }

        h1 {
            color: white;
        }

        .video {
            position: relative;
            display: inline-block;
            width: calc(43%);
            /* height: calc(50% - 5px); */
            padding-top: calc(56.25% * 0.43);
        }

        .video>iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .plus {
            position: fixed;
            right: 20px;
            bottom: 20px;
        }

        .minus {
            position: absolute;
            right: 10px;
            top: 10px;
            z-index: 10;
            color: red;
        }

        .navbutton {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 30px;
            color: white;
            cursor: pointer;
        }

        .sidenav {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #ccc;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }

        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #000;
            display: block;
            transition: 0.3s;
        }

        .sidenav a:hover {
            color: #f1f1f1;
        }

        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }
    </style>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
        integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
</head>

<body>
    <script type="text/javascript" language="javascript" src="liveData.js"></script>

    <script>
        window.onload = function () {
            initLive()
        };

        function initLive() {

            // Handle default channel
            var defaultDiv = document.getElementById("default");
            var customDiv = document.getElementById("custom");

            if (liveData.length <= 0) {
                defaultDiv.innerHTML = "<h1>No Default Channel</h1>"
            }

            for (obj of liveData) {
                console.log(obj)
                if (obj.url) {
                    var element = document.createElement("div");
                    element.className = "video";
                    element.innerHTML = `
                        <button type="button" class="minus" onclick="removeLive(this)">
                            <i class="fas fa-minus fa-1x"></i>
                        </button>
                        <iframe
                            id = "${obj.url}"
                            src = "https://www.facebook.com/plugins/video.php?href=${obj.url}"
                            width = "100%" height = "100%" style = "border:none;overflow:hidden" scrolling = "no" frameborder = "0"
                            allowTransparency = "true" allowFullScreen = "true" webkit - playsinline ></iframe >
                    `
                    defaultDiv.append(element);
                }
            }

            // Handle customized channel
            var fbLives = JSON.parse(localStorage.getItem("fbLives"));
            for (link of fbLives) {
                if (link) {
                    var element = document.createElement("div");
                    element.className = "video";
                    element.innerHTML = `
                        <button type="button" class="minus" onclick="removeLive(this)">
                            <i class="fas fa-minus fa-1x"></i>
                        </button>
                        <iframe
                            id = "${link}"
                            src = "https://www.facebook.com/plugins/video.php?href=${link}"
                            width = "100%" height = "100%" style = "border:none;overflow:hidden" scrolling = "no" frameborder = "0"
                            allowTransparency = "true" allowFullScreen = "true" webkit - playsinline ></iframe >
                    `

                    customDiv.append(element);
                }
            }
        }

        function addLive() {
            var link = prompt("Please enter the Facebook link");
            if (link != null) {
                var element = document.createElement("div");
                element.innerHTML = `
                    <button type="button" class="minus" onclick="removeLive(this)">
                        <i class="fas fa-minus fa-1x"></i>
                    </button>
                    <iframe
                        id = "${link}"
                        src = "https://www.facebook.com/plugins/video.php?href=${link}"
                        width = "100%" height = "100%" style = "border:none;overflow:hidden" scrolling = "no" frameborder = "0"
                        allowTransparency = "true" allowFullScreen = "true" webkit - playsinline ></iframe >
                `

                var addButton = document.getElementById("addButton");
                document.body.insertBefore(element, addButton);

                var fbLives = JSON.parse(localStorage.getItem("fbLives")) || [];
                fbLives.push(link)
                localStorage.setItem("fbLives", JSON.stringify(fbLives));
            }
        }

        function removeLive(element) {
            var liveElement = element.parentElement;
            var link = liveElement.getElementsByTagName("iframe")[0].getAttribute("id")
            document.body.removeChild(liveElement)

            var fbLives = JSON.parse(localStorage.getItem("fbLives")) || [];
            var index = fbLives.indexOf(link)
            if (index > -1) {
                fbLives.splice(index, 1);
            }
            localStorage.setItem("fbLives", JSON.stringify(fbLives));
        }

        function openNav() {
            document.getElementById("mySidenav").style.width = "25%";
        }

        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
        }
    </script>

    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="javascript:void(0)">Live</a>
        <a href="./history.html">History</a>
        <a href="./highlight.html">Highlight</a>
    </div>

    <span class="navbutton" onclick="openNav()">&#9776;</span>

    <button id="addButton" type="button" class="plus" onclick="addLive()">
        <i class="fas fa-plus fa-3x"></i>
    </button>

    <div id="custom">
    </div>

    <div id="default">
    </div>

    <div>
        <h1>
            在此呼籲各位請盡可能參加616遊行並帶同鮮花/紙花/紙鶴以作記念，謹記以「只撤不緩」為最終目的。<br>
            因遊行期間未能取得最新消息，如有最新直播，請在 <a href="https://lihkg.com/thread/1228615/">LIHKG</a> 上留言。
        </h1>
    </div>

</body>

</html>